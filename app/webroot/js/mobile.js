function ajaxGet(a,b,c){$.ajax({url:a,error:function(a,b){handleAjaxError(a,b)},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide");c()},success:function(a,c,d){b.html(a)}})}function viewVanban(a){$.ajax({url:"/mobile/vanban/view/"+a,dataType:"json",error:function(a,b){messageBox(b)},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a,b,c){var d="";d+="<p><strong>"+a.Tinhchatvanban.ten_tinhchat+" : "+a.Vanban.so_hieu+" <BR>"+a.Vanban.trich_yeu+"</strong></p>";d+="<p>Ngày phát hành: "+a.Vanban.ngay_phathanh+" - Nơi phát hành: "+a.Vanban.noi_gui+"</p>";if(a.Vanban.chieu_di==0)d+="<p>Ngày gửi: "+a.Vanban.ngay_gui+"</p>";else d+="<p>Ngày văn bản đến: "+a.Vanban.ngay_nhan+"</p>";d+="<p>Người ký: "+a.Vanban.nguoi_ky+"</p>";$("#vanban-info").html(d);var e=$(window).width()-60;var f=Math.floor(e*11/8);var g="";for(var h=0;h<a.Filevanban.length;h++){if(h==0)g+='<div data-role="collapsible" data-collapsed="false">';else g+='<div data-role="collapsible">';g+="<h3>File "+(h+1)+"</h3>";g+='<iframe style="border-style: none;" src="https://docs.google.com/viewer?url='+a.file_path+a.Filevanban[h].path+'&embedded=true" width="'+e+'" height="'+f+'"></iframe>';g+="</div>"}$("#vanban-files").html(g);$("#vanban-files").collapsibleset("refresh")}});$.mobile.changePage($("#vanban-detail"))}function viewTinnhan(a){$.ajax({url:"/mobile/tinnhan/view/"+a,dataType:"json",error:function(a,b){messageBox(b)},beforeSend:function(){},complete:function(){},success:function(a,b,c){$.mobile.loading("show");$("#tinnhan-detail").attr("data-id",a.id);$("#tinnhan-detail-reply").attr("href","/mobile/tinnhan/compose/replyto:"+a.id);$("#tinnhan-detail-forward").attr("href","/mobile/tinnhan/compose/forwardto:"+a.id);$("#tinnhan-title").html(a.tieu_de);$("#tinnhan-nguoigui").html(a.nguoi_gui);$("#tinnhan-ngaygui").html(a.ngay_gui);$("#tinnhan-noidung").html(a.noi_dung);var d="";for(var e=0;e<a.files.length;e++){d+='<li><a data-ajax="false" title="Click để download file này" href="'+a.file_path+a.files[e]+'">'+a.files[e]+"</a>"}if(d=="")$("#attach-container").remove();else{$("#tinnhan-attach").html(d);$("#tinnhan-attach").listview("refresh")}$.mobile.loading("hide")}});$.mobile.changePage($("#tinnhan-detail"))}function viewTinnhanDagui(a){$.ajax({url:"/mobile/tinnhan/view_sent/"+a,dataType:"json",error:function(a,b){messageBox(b)},beforeSend:function(){},complete:function(){},success:function(a,b,c){$.mobile.loading("show");$("#tinnhan-sent").attr("data-id",a.id);$("#tinnhan-sent-title").html(a.tieu_de);$("#tinnhan-sent-ngaygui").html(a.ngay_gui);$("#tinnhan-sent-noidung").html(a.noi_dung);var d="";for(var e=0;e<a.files.length;e++){d+='<li><a data-ajax="false" title="Click để download file này" href="'+a.file_path+a.files[e]+'">'+a.files[e]+"</a>"}if(d=="")$("#sent-attach-container").remove();else{$("#sent-tinnhan-attach").html(d);$("#sent-tinnhan-attach").listview("refresh")}var f="";for(var e=0;e<a.nguoinhan.length;e++){d+="<li>"+a.nguoinhan[e]+"</li>"}$("#sent-tinnhan-nguoinhan").html(d);$("#sent-tinnhan-nguoinhan").listview("refresh");$.mobile.loading("hide")}});$.mobile.changePage($("#tinnhan-sent"))}function confirmBox(a,b,c){$("#confirm .confirm-title").text(a);$("#confirm .confirm-desc").text(b);$("#confirm .confirm-do").unbind();$("#confirm .confirm-do").click(c);$.mobile.changePage("#confirm")}function showTinnhanOptions(a){$("#tinnhan-options-reply").attr("href","/mobile/tinnhan/compose/replyto:"+a);$("#tinnhan-options-forward").attr("href","/mobile/tinnhan/compose/forwardto:"+a);$("#tinnhan-options-delete").unbind();$("#tinnhan-options-delete").click(function(){delTinnhan(a)});$.mobile.changePage("#tinnhan-options")}function messageBox(a){$("<div class='ui-loader ui-overlay-shadow ui-body-e ui-corner-all'><h4>"+a+"</h4></div>").css({padding:10,display:"block",opacity:.96,top:$(window).scrollTop()+100}).appendTo($.mobile.pageContainer).delay(3200).fadeOut(400,function(){$(this).remove()})}function validateForm(a){var b=$("input[required]",a).filter(function(){return!$.trim(this.value).length});if(b.length){b.css("border","1px solid red");messageBox("Bạn cần phải nhập tất cả các field !");return false}return true}function delTinnhan(a){var b=false;confirmBox("Xác nhận","Bạn có muốn xóa tin nhắn này không ?",function(){$.ajax({url:"/mobile/tinnhan/unread_delete/"+a,dataType:"json",error:function(a,b){messageBox("Đã phát sinh lỗi. Vui lòng thử lại.")},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a,c,d){$(".ui-dialog").dialog("close");messageBox(a.message);b=a.success}})});return b}function deleteTinnhanDagui(a){var b=false;confirmBox("Xác nhận","Bạn có muốn xóa tin nhắn này không ?",function(){$.ajax({url:"/mobile/tinnhan/sent_delete/"+a,dataType:"json",error:function(a,b){messageBox("Đã phát sinh lỗi. Vui lòng thử lại.")},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a,c,d){$(".ui-dialog").dialog("close");messageBox(a.message);b=a.success}})});return b}function updateMainTask(a){$("#maintask-cancel").unbind();$("#maintask-cancel").click(function(){$(".ui-dialog").dialog("close")});$("#maintask-submit").unbind();$("#maintask-submit").click(function(){$.ajax({type:"POST",url:"/mobile/congviec/update_maintask/"+a,dataType:"json",data:$("#update-maintask-form").serialize(),error:function(a,b){messageBox("Đã phát sinh lỗi. Vui lòng thử lại.")},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a,b,c){$(".ui-dialog").dialog("close");messageBox(a.message);location.reload()}})});$.mobile.changePage("#congviec-update-maintask")}function updateTask(a,b){$("#congviec-update-task").page();$("#task-mucdohoanthanh").val(b);$("#task-mucdohoanthanh").slider("refresh");$("#task-cancel").unbind();$("#task-cancel").click(function(){$(".ui-dialog").dialog("close")});$("#task-submit").unbind();$("#task-submit").click(function(){$.ajax({type:"POST",url:"/mobile/congviec/update_task/"+a,dataType:"json",data:$("#update-task-form").serialize(),error:function(a,b){messageBox("Đã phát sinh lỗi. Vui lòng thử lại.")},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a,b,c){$(".ui-dialog").dialog("close");messageBox(a.message);location.reload()}})});$.mobile.changePage("#congviec-update-task")}$(document).bind("mobileinit",function(){$.mobile.defaultPageTransition="fade";$.mobile.page.prototype.options.headerTheme="b";$.mobile.page.prototype.options.footerTheme="b";$.mobile.loadPage.defaults.domCache=false;$.mobile.loader.prototype.options.text="đang lấy dữ liệu";$.mobile.loader.prototype.options.textVisible=true;$.mobile.loader.prototype.options.theme="e";$.mobile.loader.prototype.options.html="";$.mobile.ignoreContentEnabled=true;$("#vanban").live("pageshow",function(){});$("#vanban-chuadoc").live("pageshow",function(){doOnCallBack=function(){$("#chuadoc-list").listview("refresh")};ajaxGet("/mobile/vanban/chuadoc",$("#chuadoc-list"),doOnCallBack);$("#chuadoc-next").click(function(){ajaxGet($(this).attr("href"),$("#chuadoc-list"),doOnCallBack)});$("#chuadoc-prev").click(function(){ajaxGet($(this).attr("href"),$("#chuadoc-list"),doOnCallBack)})});$("#vanban-tatca").live("pageshow",function(){doOnCallBack=function(){$("#tatca-list").listview("refresh")};ajaxGet("/mobile/vanban/tatca",$("#tatca-list"),doOnCallBack);$("#next").click(function(){ajaxGet($(this).attr("href"),$("#tatca-list"),doOnCallBack)});$("#prev").click(function(){ajaxGet($(this).attr("href"),$("#tatca-list"),doOnCallBack)})});$("#vanban-di").live("pageshow",function(){doOnCallBack=function(){$("#di-list").listview("refresh")};ajaxGet("/mobile/vanban/di",$("#di-list"),doOnCallBack);$("#di-next").click(function(){ajaxGet($(this).attr("href"),$("#di-list"),doOnCallBack)});$("#di-prev").click(function(){ajaxGet($(this).attr("href"),$("#di-list"),doOnCallBack)})});$("#vanban-den").live("pageshow",function(){doOnCallBack=function(){$("#den-list").listview("refresh")};ajaxGet("/mobile/vanban/den",$("#den-list"),doOnCallBack);$("#den-next").click(function(){ajaxGet($(this).attr("href"),$("#den-list"),doOnCallBack)});$("#den-prev").click(function(){ajaxGet($(this).attr("href"),$("#den-list"),doOnCallBack)})});$("#vanban-theodoi").live("pageshow",function(){doOnCallBack=function(){$("#theodoi-list").listview("refresh")};ajaxGet("/mobile/vanban/theodoi",$("#theodoi-list"),doOnCallBack);$("#theodoi-next").click(function(){ajaxGet($(this).attr("href"),$("#theodoi-list"),doOnCallBack)});$("#theodoi-prev").click(function(){ajaxGet($(this).attr("href"),$("#theodoi-list"),doOnCallBack)})});$("#tinnhan-chuadoc").live("pageshow",function(){doOnCallBack=function(){$("#chuadoc-list").listview("refresh")};ajaxGet("/mobile/tinnhan/chuadoc",$("#chuadoc-list"),doOnCallBack);$("#chuadoc-next").click(function(){ajaxGet($(this).attr("href"),$("#chuadoc-list"),doOnCallBack)});$("#chuadoc-prev").click(function(){ajaxGet($(this).attr("href"),$("#chuadoc-list"),doOnCallBack)})});$("#tinnhan-tatca").live("pageshow",function(){doOnCallBack=function(){$("#tatca-list").listview("refresh")};ajaxGet("/mobile/tinnhan/tatca",$("#tatca-list"),doOnCallBack);$("#tatca-next").click(function(){ajaxGet($(this).attr("href"),$("#tatca-list"),doOnCallBack)});$("#tatca-prev").click(function(){ajaxGet($(this).attr("href"),$("#tatca-list"),doOnCallBack)})});$("#tinnhan-dagui").live("pageshow",function(){doOnCallBack=function(){$("#dagui-list").listview("refresh")};ajaxGet("/mobile/tinnhan/dagui",$("#dagui-list"),doOnCallBack);$("#dagui-next").click(function(){ajaxGet($(this).attr("href"),$("#dagui-list"),doOnCallBack)});$("#dagui-prev").click(function(){ajaxGet($(this).attr("href"),$("#dagui-list"),doOnCallBack)})});$("#tinnhan-detail").live("pageshow",function(){$("#tinnhan-detail-delete").unbind();$("#tinnhan-detail-delete").click(function(){if(delTinnhan($("#tinnhan-detail").attr("data-id")))location="/mobile/tinnhan";return false})});$("#tinnhan-sent").live("pageshow",function(){$("#tinnhan-sent-delete").unbind();$("#tinnhan-sent-delete").click(function(){if(deleteTinnhanDagui($("#tinnhan-sent").attr("data-id")))location="/mobile/tinnhan";return false})});$("#tinnhan-compose").live("pageshow",function(){$("#tinnhan-compose .check-all").click(function(){var a=$(this).attr("checked")==undefined?false:true;var b=$(this).parent().parent().parent();$("input[type=checkbox]",b).attr("checked",a).checkboxradio("refresh")});$("#checkall").click(function(){var a=$(this).attr("checked")==undefined?false:true;$("input[type=checkbox]").attr("checked",a).checkboxradio("refresh")});var a=$("#tinnhan-compose input[type=checkbox]").filter(":checked");a.each(function(){$(this).parent().parent().parent().parent().parent().trigger("expand")});$("#tinnhan-submit").click(function(){if(validateForm("#tinnhan-compose-form")){$.ajax({type:"POST",url:"/mobile/tinnhan/compose",dataType:"json",data:$("#tinnhan-compose-form").serialize(),error:function(a,b){messageBox("Đã phát sinh lỗi.")},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a,b,c){messageBox("Tin nhắn đã được gửi.")}})}})});$("#congviec-dagiao").live("pageshow",function(){var a=$("#congviec-dagiao").attr("data-loai");doOnCallBack=function(){$("#congviec-dagiao-list").listview("refresh")};ajaxGet("/mobile/congviec/dagiao_ajax/"+a,$("#congviec-dagiao-list"),doOnCallBack);$("#congviec-dagiao-next").click(function(){ajaxGet($(this).attr("href"),$("#congviec-dagiao-list"),doOnCallBack)});$("#congviec-dagiao-prev").click(function(){ajaxGet($(this).attr("href"),$("#congviec-dagiao-list"),doOnCallBack)})});$("#congviec-duocgiao").live("pageshow",function(){var a=$("#congviec-duocgiao").attr("data-loai");doOnCallBack=function(){$("#congviec-duocgiao-list").listview("refresh")};ajaxGet("/mobile/congviec/duocgiao_ajax/"+a,$("#congviec-duocgiao-list"),doOnCallBack);$("#congviec-duocgiao-next").click(function(){ajaxGet($(this).attr("href"),$("#congviec-duocgiao-list"),doOnCallBack)});$("#congviec-duocgiao-prev").click(function(){ajaxGet($(this).attr("href"),$("#congviec-duocgiao-list"),doOnCallBack)})})});